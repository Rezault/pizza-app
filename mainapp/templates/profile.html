{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container">
    {% if user.is_authenticated %}
    <h2>Welcome, {{ user.username }}!</h2>
    <h3>Your Previous Orders</h3>

    {% if orders %}
      <p>Total {{ orders|length }} orders.</p>
    {% else %}
        <p>No orders found.</p>
    {% endif %}

    <div class="accordion" id="orderAccordion">
      {% for order in orders %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ order.id }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ order.id }}" aria-expanded="false" aria-controls="collapse{{ order.id }}">
             Order #{{ order.id }} - {{ order.order_date|date:"M d, Y H:i" }}
          </button>
        </h2>
        <div id="collapse{{ order.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ order.id }}" data-bs-parent="#orderAccordion">
          <div class="accordion-body">
            <!-- Order Details -->
            <p><strong>Customer Name:</strong> {{ order.customer_name }}</p>
            <p><strong>Delivery Address:</strong> {{ order.address }}</p>
            <p><strong>Order Date:</strong> {{ order.order_date|date:"M d, Y H:i" }}</p>
            
            <!-- Order Items Table -->
            <table class="table table-bordered mt-3">
              <thead>
                <tr>
                  <th>Pizza</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody>
                {% for item in order.order_items.all %}
                <tr>
                  <td>{{ item.pizza }}</td>
                  <td>
                    <ul class="list-unstyled">
                      <li><strong>Size:</strong> {{ item.pizza.size }}</li>
                      <li><strong>Crust:</strong> {{ item.pizza.crust }}</li>
                      <li><strong>Sauce:</strong> {{ item.pizza.sauce }}</li>
                      <li><strong>Cheese:</strong> {{ item.pizza.cheese }}</li>
                      <li><strong>Toppings:</strong>
                        {% if item.pizza.toppings.all %}
                          {% for topping in item.pizza.toppings.all %}
                            {{ topping }}{% if not forloop.last %}, {% endif %}
                          {% endfor %}
                        {% else %}
                          None
                        {% endif %}
                      </li>
                    </ul>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    

  
    <a href="{% url 'create_pizza' %}">Create a Pizza</a>
    {% else %}
    <p>Please log in.</p>
    {% endif %}
</div>
{% endblock %}
